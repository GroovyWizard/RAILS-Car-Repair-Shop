<%= form_with(model: sale) do |form| %>
  <% if sale.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(sale.errors.count, "error") %> prohibited this sale from being saved:</h2>
      <ul>
        <% sale.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>
  <div class="field">
    <%= form.label :name %>
    <%= form.text_field :name %>
  </div>
  <div class="field">
    <%= form.label :description %>
    <%= form.text_field :description %>
  </div>
  <div class="field">
    <%= form.label :value %>
    <%= form.text_field :value %>
  </div>

  <p> Esta venda pertence a um cliente ou serviço? </p>
    <label for="client">    
      <input type="checkbox" id="client" name="client" class="client" value="client" onchange="validateVisibility()"> Cliente
    </label><br>
    
    <label for="service"> 
        <input type="checkbox" id="service" name="service" class="service" value="service" onchange="validateVisibility()"> Serviço
    </label><br>



  <div class="field" id="client_form" style="visibility: hidden">
    <%= form.label :client_id %>
    <%= form.select(:client_id, Client.all.collect {|p| [ p.name, p.id ] }, 
                                                   { }, 
                                                   { :multiple => false, :size => 1  }) %>                                      
  </div>

  <div class="field" id="service_form" style="visibility: hidden" >
    <%= form.label :service_id %>
    <%= form.select(:service_id, Service.all.collect {|p| [ p.title, p.id ] }, 
                                                   { }, 
                                                   { :multiple => false, :size => 1 }) %>                                      
  </div>


  <div class="form-group pt-2">
   <%= form.select(:part_ids, @parts.collect {|p| [ p.name, p.id ] }, 
                                                   { }, 
                                                   { :multiple => true, :size => 5  }) %>                                      
  </div>
  
  
  <div class="actions">
    <%= form.submit %>
  </div>
<% end %>

<script> 
    var serviceVisibility;
    var clientVisibility;
    var client =  document.getElementById('client')
    var service = document.getElementById('service')
    
    function changeVisibility() 
    {
      document.getElementById('service_form').style.visibility = serviceVisibility;
      document.getElementById('client_form').style.visibility = clientVisibility;
    }

    function validateVisibility()
    {
      if (service.checked == true && client.checked == true)
      {
        client.checked = false 
        service.checked = false 
        serviceVisibility = "hidden"
        clientVisibility = "hidden"
      }
      else if (client.checked == true) 
      {
        serviceVisibility = "hidden"
        clientVisibility = "visible"
      } else if(service.checked == true) 
      {
        serviceVisibility = "visible"
        clientVisibility = "hidden" 
      }
      else 
      {
        serviceVisibility = "hidden"
        clientVisibility = "hidden"
      }
      changeVisibility()

    }

</script>